<div cg-busy="vm.vendorLoadingPromise"></div>
<div class="offerings-editor">
    <ul class="vendor-accordion">
        <li carli-accordion ng-repeat="vendor in vm.vendors">
            <header ng-click="vm.toggleVendorAccordion(vendor)" cg-busy="vm.loadingPromise[vendor.id]">
                <button type="button" class="angle-icon-container">
                    <fa name="angle-down"></fa>
                </button>
                {{ ::vendor.name }}
                <span class="vendor-status">{{ ::vm.getVendorPricingStatus(vendor) }}</span>
            </header>
            <div class="content" ng-if="vm.openAccordion === vendor.id">
                <ul class="product-content">
                    <li ng-repeat="product in ::vendor.products | filter:{isActive:true} track by product.id">
                        <div class="product-header">
                            {{ ::product.name }}
                            <span class="price-cap">Price Cap: <strong>{{ ::product.priceCap }}%</strong></span>
                        </div>
                        <ul class="offerings-list">
                            <li class="column-headers">
                                <div class="sortable column library" ng-class="{ activeSort: vm.orderBy === 'library.name', reversedSort: vm.reverse }" ng-click="vm.sort('library.name')">Library</div>
                                <div class="column library-view">Library View</div>
                                <div class="sortable column selected-last-year" ng-class="{ activeSort: vm.orderBy === 'selectedLastYear', reversedSort: vm.reverse }" ng-click="vm.sort('selectedLastYear')">Selected Last Year</div>
                                <div class="sortable column site-license-price" ng-class="{ activeSort: vm.orderBy === 'pricing.site', reversedSort: vm.reverse }" ng-click="vm.sort('pricing.site')">Site License Price</div>
                                <div class="column selection">Selection</div>
                                <div class="column vendor-invoice">Vendor Invoice</div>
                            </li>
                            <li class="offering" ng-repeat="offering in product.offerings | orderBy:vm.orderBy:vm.reverse track by offering.id">
                                <div class="column library">
                                    <checkbox ng-model="vm.selectedOfferings[vendor.id][offering.id]"></checkbox>
                                    <div class="library-info">
                                        <span class="name">{{ ::offering.library.name }}</span>
                                        <div>
                                            <span class="key">Size (FTE):</span><span class="value">{{ ::offering.library.fte }}</span>
                                        </div>
                                        <div>
                                            <span class="key">Institution:</span><span class="value">{{ ::offering.library.institutionYears }}</span>
                                        </div>
                                        <div>
                                            <span class="key">Type:</span><span class="value">{{ ::offering.library.institutionType }}</span>
                                        </div>
                                    </div>
                                    <button ng-show="!vm.isEditing[offering.id]" type="button" class="carli-button edit" ng-click="vm.setOfferingEditable(offering)">Edit <span class="fa fa-pencil-square-o "></span></button>
                                    <button ng-show="vm.isEditing[offering.id]" type="button" class="carli-button save" ng-click="vm.saveOffering(offering, product.offerings)">Save <span class="fa fa-floppy-o"></span></button>
                                </div>
                                <div class="column library-view">
                                    <div class="display">
                                            <strong class="purple">{{ ::vm.offeringDisplayLabels[offering.display] }}</strong>
                                    </div>
                                    <div class="comments">
                                        <div class="column internal-comments">
                                            <label for="internal-comments">Internal Comments</label>
                                            <textarea id="internal-comments" ng-model="offering.internalComments" ng-readonly="!vm.isEditing[offering.id]">{{ ::offering.internalComments }}</textarea>
                                        </div>
                                        <div class="column library-comments">
                                            <label for="library-comments">Comments for Libraries</label>
                                            <textarea id="library-comments" ng-model="offering.libraryComments" ng-readonly="!vm.isEditing[offering.id]">{{ ::offering.libraryComments }}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="column selected-last-year">
                                    <fa ng-if="::offering.history[vm.lastYear].selection" name="star"></fa>
                                </div>
                                <div class="column site-license-price">
                                    <div class="site-pricing single-column">
                                        <div class="column">
                                            <div class="header"><strong>{{ ::vm.year }}</strong> Price</div>
                                            <div class="row">
                                                    {{ ::vm.offering.pricing.site | currency }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="su-pricing single-column">
                                        <div class="header"><strong>Simultaneous User Price</strong></div>
                                        <div class="column">
                                            <div class="edit-su-pricing">
                                                <table>
                                                    <thead>
                                                    <tr>
                                                        <th><strong>{{ ::vm.year }}</strong> Price</th>
                                                        <th>User(s)</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr ng-repeat="price in offering.pricing">
                                                        <td>{{ ::price.price | currency }}</td>
                                                        <td>{{ ::price.users }}</td>
                                                    </tr>
                                                    <tr ng-show="vm.editMode" ng-click="vm.addPriceRow()"><td class="add-su-pricing" colspan="2"><button class="carli-button add">Add S.U. Price <fa name="plus-circle"></fa></button></td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="column selection">
                                    <label for="{{ ::offering.id }}_selection" class="sr-only">Library Selection</label>
                                    <div class="selection-display" ng-show="offering.selection">
                                        <div class="users"><span class="label">Selection:</span> {{ ::offering.selection.users }} {{ ::offering.selection.users === 'site' ? '' : 'Users' }}</div>
                                        <div class="price"><span class="label">Price:</span> {{ ::offering.selection.price | currency }}</div>
                                    </div>
                                </div>
                                <div class="column vendor-invoice">
                                    <div class="label">Vendor Price</div>
                                        {{ ::offering.invoice.price | currency }}
                                    <div class="label">Invoice #</div>
                                        {{ ::offering.invoice.number }}
                                </div>
                            </li>
                        </ul>
                        <div class="product footer"></div>
                    </li>
                </ul>
                <div class="vendor footer">
                    <div class="total">
                        <span class="label">Selection Total:</span>
                        <span>{{ vm.selectionTotal[vendor.id] | currency }}</span>
                        <span class="label">Vendor Invoice Total:</span>
                        <span>{{ vm.invoiceTotal[vendor.id] | currency }}</span>
                    </div>
                    <button type="button" class="carli-button" ng-click="vm.reportCheckedProductsForVendor(vendor)">Report Checked Products</button>
                    <div class="placeholder pull-left" style="width: 400px;">TODO: Report All Products</div>
                </div>
            </div>
        </li>
    </ul>
</div>

<div class="notifications placeholder" style="width: 400px; margin-bottom: 1rem;">
    TODO: Report All Vendors
</div>
